Index: configure.in
===================================================================
RCS file: /cvsroot/xchat/xchat2/configure.in,v
retrieving revision 1.59
diff -u -r1.59 configure.in
--- configure.in	7 Apr 2004 06:03:45 -0000	1.59
+++ configure.in	9 May 2004 18:04:25 -0000
@@ -60,6 +60,10 @@
 [  --enable-memdebug       enable use of Memory Debug (default: no)],
         memdebug=$enableval, memdebug=no)
 
+AC_ARG_ENABLE(profiling,
+[  --enable-profiling      turn on profiling support (default: no)],
++       profiling=$enableval, profiling=no)
+
 AC_ARG_ENABLE(socks,
 [  --enable-socks          enable use of SOCKS5 (default: no)],
         socks=$enableval, socks=no)
@@ -84,9 +88,9 @@
 [  --enable-textfe         build the text frontend (default: no)],
         textfe=$enableval, textfe=no)
 
-dnl AC_ARG_ENABLE(gnome,
-dnl [  --disable-gnome         disable use of gnome],
-dnl        gnome=$enableval, gnome=yes)
+AC_ARG_ENABLE(gnomefe,
+[  --enable-gnomefe       build the gnome frontend (default: no)],
+       gnomefe=$enableval, gnomefe=no)
 
 dnl AC_ARG_ENABLE(zvt,
 dnl [  --disable-zvt           disable zvt/shelltab feature],
@@ -158,7 +162,7 @@
 fi
 
 if test "$gtkfe" != yes; then
-	gnome=no
+	gnomefe=no
 	zvt=no
 	COMMON_LIBS="$GLIB_LIBS"
 	COMMON_CFLAGS="$GLIB_CFLAGS"
@@ -171,22 +175,38 @@
 GUI_LIBS="$GUI_LIBS $GTK_LIBS"
 GUI_CFLAGS="$GUI_CFLAGS $GTK_CFLAGS"
 
-gnome=no
-#if test "$gnome" = yes; then
-#	AC_PATH_PROG(pkgconfigpath, pkg-config)
-#	AC_MSG_CHECKING(Gnome2 compile flags)
-#	GNOME_CFLAGS="`$pkgconfigpath libgnome-2.0 --cflags 2>/dev/null`"
-#	if test "_$GNOME_CFLAGS" = _ ; then
-#		gnome=no
-#		AC_MSG_RESULT([Gnome not found, building without it.])
-#	else
-#		GNOME_VER="`$pkgconfigpath libgnome-2.0 --modversion`"
-#		GUI_LIBS="$GUI_LIBS `$pkgconfigpath libgnome-2.0 --libs`"
-#		GUI_CFLAGS="$GUI_CFLAGS $GNOME_CFLAGS"
-#		AC_DEFINE(USE_GNOME)
-#		AC_MSG_RESULT(ok)
-#	fi
-#fi
+AM_PATH_GTK_2_0(2.3.1, havenewgtk=yes, havenewgtk=no)
+
+if test "$havenewgtk" != yes; then
+	gnomefe=no
+	echo
+	echo Cannot find GTK+ 2.3\! Not building GNOME FrontEnd.
+	echo
+fi
+
+if test "$gnomefe" = yes; then
+	AC_PATH_PROG(pkgconfigpath, pkg-config)
+	AC_MSG_CHECKING(Gnome2 compile flags)
+	GNOME_CFLAGS="`$pkgconfigpath libgnome-2.0 libgnomeui-2.0 libglade-2.0 gnome-vfs-2.0 gconf-2.0 --cflags 2>/dev/null`"
+	if test "_$GNOME_CFLAGS" = _ ; then
+		gnomefe=no
+		AC_MSG_RESULT([Gnome not found, building without it.])
+	else
+		GNOME_VER="`$pkgconfigpath libgnome-2.0 --modversion`"
+		GUI_LIBS="$GUI_LIBS `$pkgconfigpath libgnome-2.0 --libs`"
+		GUI_LIBS="$GUI_LIBS `$pkgconfigpath libgnomeui-2.0 --libs`";
+		GUI_LIBS="$GUI_LIBS `$pkgconfigpath libglade-2.0 --libs`";
+		GUI_LIBS="$GUI_LIBS `$pkgconfigpath gnome-vfs-2.0 --libs`";
+		GUI_LIBS="$GUI_LIBS `$pkgconfigpath gconf-2.0 --libs`";
+		GUI_CFLAGS="$GUI_CFLAGS $GNOME_CFLAGS"
+		AC_MSG_RESULT(ok)
+	fi
+
+fi
+
+# GConf
+AC_PATH_PROG(GCONFTOOL, gconftool-2, no)
+AM_GCONF_SOURCE_2
 
 dnl *********************************************************************
 dnl ** XFT **************************************************************
@@ -465,6 +485,7 @@
 AM_CONDITIONAL(USE_OPENSSL, test "x$openssl" = "xyes")
 AM_CONDITIONAL(DO_TEXT, test "x$textfe" = "xyes")
 AM_CONDITIONAL(DO_GTK, test "x$gtkfe" = "xyes")
+AM_CONDITIONAL(DO_GNOME, test "x$gnomefe" = "xyes")
 AM_CONDITIONAL(DO_PERL, test "x$perl" = "xyes")
 AM_CONDITIONAL(DO_PYTHON, test "x$python" = "xyes")
 AM_CONDITIONAL(DO_TCL, test "x$tcl" = "xyes")
@@ -561,6 +582,10 @@
 	fi
 fi
 
+if test x$enable_profiling = xyes; then
+	CFLAGS="$CFLAGS -pg"
+fi
+
 dnl *********************************************************************
 dnl ** FUNCTIONS/LIBS/CFLAGS ********************************************
 dnl *********************************************************************
@@ -648,6 +673,9 @@
 src/Makefile
 src/common/Makefile
 src/fe-text/Makefile
+src/fe-gnome/Makefile
+src/fe-gnome/data/Makefile
+src/fe-gnome/pixmaps/Makefile
 src/fe-gtk/Makefile
 src/pixmaps/Makefile
 plugins/Makefile
@@ -661,8 +689,9 @@
 echo
 echo xchat $VERSION
 echo
-echo Building GTK+ Interface .... : $gtkfe
-echo Building TEXT Interface .... : $textfe
+echo Building GTK+  Interface .... : $gtkfe
+echo Building TEXT  Interface .... : $textfe
+echo Building GNOME Interface .... : $gnomefe
 echo
 echo PLUGINS: Perl: $perl Python: $python TCL: $tcl
 echo
Index: src/Makefile.am
===================================================================
RCS file: /cvsroot/xchat/xchat2/src/Makefile.am,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 Makefile.am
--- src/Makefile.am	28 Nov 2002 10:39:00 -0000	1.1.1.1
+++ src/Makefile.am	9 May 2004 18:04:26 -0000
@@ -11,4 +11,8 @@
 gtk_fe = fe-gtk
 endif
 
-SUBDIRS = pixmaps common $(gtk_fe) $(text_fe)
+if DO_GNOME
+gnome_fe = fe-gnome
+endif
+
+SUBDIRS = pixmaps common $(gtk_fe) $(text_fe) $(gnome_fe)
